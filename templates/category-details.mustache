{{!
    This file is part of Moodle - https://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template profilefield_database/category-details

    Example context (json):
    {
      "category": {
        "field0": "Category Field 0",
        "field1": "Category Field 1",
        "field2": "Category Field 2",
        "field3": "Category Field 3",
        "field4": "Category Field 4",
        "field5": "Category Field 5",
        "field6": "Category Field 6",
        "field7": "Category Field 7",
        "field8": "Category Field 8",
        "field9": "Category Field 9",
        "field69": "Category Field 69",
        "id": "123"
      },
      "datas": [
        {
          "data0": "Data 0",
          "data1": "Data 1",
          "data2": "Data 2",
          "data3": "Data 3",
          "data4": "Data 4",
          "data5": "Data 5",
          "data6": "Data 6",
          "data7": "Data 7",
          "data8": "Data 8",
          "data69": "Data 69",
          "id": "1"
        },
        {
          "data0": "Data 0",
          "data1": "Data 1",
          "data2": "Data 2",
          "data3": "Data 3",
          "data4": "Data 4",
          "data5": "Data 5",
          "data6": "Data 6",
          "data7": "Data 7",
          "data8": "Data 8",
          "data69": "Data 69",
          "id": "2"
        }
      ],
      "num_datas": 2
    }
}}

<div class="table-responsive">
    <table class="generaltable">
        <thead>
        <tr>
            <th class="header c0">{{category.field0}}</th>
            <th class="header c0">{{category.field1}}</th>
            {{#category.field2}}
                <th class="header c0">{{category.field2}}</th>
            {{/category.field2}}
            {{#category.field3}}
                <th class="header c0">{{category.field3}}</th>
            {{/category.field3}}
            {{#category.field4}}
                <th class="header c0">{{category.field4}}</th>
            {{/category.field4}}
            {{#category.field5}}
                <th class="header c0">{{category.field5}}</th>
            {{/category.field5}}
            {{#category.field6}}
                <th class="header c0">{{category.field6}}</th>
            {{/category.field6}}
            {{#category.field7}}
                <th class="header c0">{{category.field7}}</th>
            {{/category.field7}}
            {{#category.field8}}
                <th class="header c0">{{category.field8}}</th>
            {{/category.field8}}
            {{#category.field9}}
                <th class="header c0">{{category.field69}}</th>
            {{/category.field9}}
            <th style="width: 100px; white-space: nowrap">&nbsp;</th>
        </tr>
        </thead>
        <tbody>
        {{#datas}}
            <tr id="field-{{id}}">
                <th class="header c0">{{data0}}</th>
                <th class="header c1">{{data1}}</th>
                {{#category.field2}}
                    <th class="header c2">{{data2}}</th>
                {{/category.field2}}
                {{#category.field3}}
                    <th class="header c3">{{data3}}</th>
                {{/category.field3}}
                {{#category.field4}}
                    <th class="header c4">{{data4}}</th>
                {{/category.field4}}
                {{#category.field5}}
                    <th class="header c5">{{data5}}</th>
                {{/category.field5}}
                {{#category.field6}}
                    <th class="header c6">{{data6}}</th>
                {{/category.field6}}
                {{#category.field7}}
                    <th class="header c7">{{data7}}</th>
                {{/category.field7}}
                {{#category.field8}}
                    <th class="header c8">{{data8}}</th>
                {{/category.field8}}
                {{#category.field9}}
                    <th class="header c9">{{data69}}</th>
                {{/category.field9}}
                <td style="width: 100px; white-space: nowrap">
                    <a href="category-data.php?id={{id}}"
                    data-dataid="{{id}}"
                    class="btn btn-primary category-data-edit">{{#str}}edit{{/str}}</a>

                    <a href="category-data.php?id={{id}}&delete=1"
                    data-dataid="{{id}}"
                    class="btn btn-danger category-data-delete">{{#str}}delete{{/str}}</a>
                </td>
            </tr>
        {{/datas}}
        </tbody>
    </table>

    {{^num_datas}}
        <div class="alert alert-warning">{{#str}}data_none,profilefield_database{{/str}}</div>
    {{/num_datas}}
    <p>
        <a href="category-data.php?id=-1&category={{category.id}}"
        id="add-new-data"
        class="btn btn-primary">{{#str}}add-new-data,profilefield_database{{/str}}</a>
    </p>
</div>

{{#js}}
    require(["jquery", "core/modal_factory", "core/templates"], function($, ModalFactory, Templates) {
        $("#add-new-data").click(function() {
            event.preventDefault();

            var templatedata = {
                "config": {
                    "sesskey": "{{config.sesskey}}",
                },
                "category": {
                    "id": "{{category.id}}",
                    "name": "{{category.name}}",
                },
                "data": {
                    "id": -1,
                },
                "datas": [
                    {"id": 0, "data": "", "field": "{{category.field0}}", "type": "{{category.type0}}"},
                    {"id": 1, "data": "", "field": "{{category.field1}}", "type": "{{category.type1}}"},
                    {"id": 2, "data": "", "field": "{{category.field2}}", "type": "{{category.type2}}"},
                    {"id": 3, "data": "", "field": "{{category.field3}}", "type": "{{category.type3}}"},
                    {"id": 4, "data": "", "field": "{{category.field4}}", "type": "{{category.type4}}"},
                    {"id": 5, "data": "", "field": "{{category.field5}}", "type": "{{category.type5}}"},
                    {"id": 6, "data": "", "field": "{{category.field6}}", "type": "{{category.type6}}"},
                    {"id": 7, "data": "", "field": "{{category.field7}}", "type": "{{category.type7}}"},
                    {"id": 8, "data": "", "field": "{{category.field8}}", "type": "{{category.type8}}"},
                    {"id": 9, "data": "", "field": "{{category.field9}}", "type": "{{category.type9}}"},
                ],
            };

            ModalFactory.create({
                title: "{{#str}}add-new-data,profilefield_database{{/str}}",
                body: Templates.render("profilefield_database/category-data", templatedata),
            }).then(function(modal) {
                modal.show();
                return modal;
            }).catch(handleError);
        });

        $(".category-data-edit").click(function() {
            event.preventDefault();

            var dataid = $(this).attr("data-dataid");

            var templatedata = {
                "config": {
                    "sesskey": "{{config.sesskey}}",
                },
                "category": {
                    "id": "{{category.id}}",
                    "name": "{{category.name}}",
                },
                "data": {
                    "id": dataid,
                },
                "datas": [
                    {
                        "id": 0,
                        "data": $(`#field-${dataid} .c0`).text(),
                        "field": "{{category.field0}}",
                        "type": "{{category.type0}}"
                    },
                    {
                        "id": 1,
                        "data": $(`#field-${dataid} .c1`).text(),
                        "field": "{{category.field1}}",
                        "type": "{{category.type1}}"
                    },
                    {
                        "id": 2,
                        "data": $(`#field-${dataid} .c2`).text(),
                        "field": "{{category.field2}}",
                        "type": "{{category.type2}}"
                    },
                    {
                        "id": 3,
                        "data": $(`#field-${dataid} .c3`).text(),
                        "field": "{{category.field3}}",
                        "type": "{{category.type3}}"
                    },
                    {
                        "id": 4,
                        "data": $(`#field-${dataid} .c4`).text(),
                        "field": "{{category.field4}}",
                        "type": "{{category.type4}}"
                    },
                    {
                        "id": 5,
                        "data": $(`#field-${dataid} .c5`).text(),
                        "field": "{{category.field5}}",
                        "type": "{{category.type5}}"
                    },
                    {
                        "id": 6,
                        "data": $(`#field-${dataid} .c6`).text(),
                        "field": "{{category.field6}}",
                        "type": "{{category.type6}}"
                    },
                    {
                        "id": 7,
                        "data": $(`#field-${dataid} .c7`).text(),
                        "field": "{{category.field7}}",
                        "type": "{{category.type7}}"
                    },
                    {
                        "id": 8,
                        "data": $(`#field-${dataid} .c8`).text(),
                        "field": "{{category.field8}}",
                        "type": "{{category.type8}}"
                    },
                    {
                        "id": 9,
                        "data": $(`#field-${dataid} .c9`).text(),
                        "field": "{{category.field9}}",
                        "type": "{{category.type9}}"
                    },
                ],
            };

            ModalFactory.create({
                title: $(`#field-${dataid} .c0`).text(),
                body: Templates.render("profilefield_database/category-data", templatedata),
            }).then(function(modal) {
                modal.show();
                return modal;
            }).catch(handleError);
        });

        $(".category-data-delete").click(function() {
            event.preventDefault();

            var dataid = $(this).attr("data-dataid");

            ModalFactory.create({
                title: "{{#str}}delete-data,profilefield_database{{/str}}",
                body: `
                    <p>{{#str}}confirm-delete-data, profilefield_database, ${$(`#field-${dataid} .c0`).text()} {{/str}}</p>
                    <div id="modal-footer" class="box py-3 modal-footer" style="margin: 0 -16px -16px;">
                        <form method="post" action="category-data.php">
                            <input type="hidden" name="id" value="${dataid}">
                            <input type="hidden" name="delete" value="1">
                            <input type="hidden" name="confirm" value="${dataid}-1">
                            <input type="hidden" name="sesskey" value="{{config.sesskey}}">
                            <button type="submit" class="btn btn-danger">{{#str}}delete{{/str}}</button>
                        </form>
                    </div>`,
            }).then(function(modal) {
                modal.show();
                return modal;
            }).catch(handleError);
        });

        function handleError(error) {
            $("#maincontent").html(error);
        }
    });
{{/js}}
